---
title: "AWS Terraform â€“  Cloud Watch  Logs ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ + Lambdaé€£æºã‚’ Terrafor"
emoji: "ğŸ–¥"
type: "tech"
topics: ["aws", "terraform"]
published: true
published_at: 2023-10-07 14:08
---

# æ¦‚è¦

Cloud Watch Logs ã®ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ã‚’ä½¿ã†ã¨
ãƒ­ã‚°ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¤œå‡ºã—ã¦Lambdaã‚’èµ·å‹•ã§ãã‚‹

AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ã®ä½œã‚Šæ–¹ã¯CloudWatchã®ãƒ­ã‚°ã‚°ãƒ«ãƒ¼ãƒ—ã‚’é¸ã‚“ã§ã€Œã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€ã‹ã‚‰è¨­å®šã§ãã‚‹

<img width="632" alt="image" src="https://github.com/YumaInaura/YumaInaura/assets/13635059/f40dd57a-4ab2-4611-bab8-1c959e28dcc8">

ã“ã‚Œã‚’Terraformç®¡ç†ã™ã‚‹

# Terraformã®ã‚³ãƒ¼ãƒ‰ä¾‹

```tf
resource "aws_cloudwatch_log_subscription_filter" "xxx" {
  name            = "xxx"
  log_group_name  = "/path/to/log_group"
  filter_pattern  = "<ãƒ•ã‚£ãƒ«ã‚¿ãƒ‘ã‚¿ãƒ¼ãƒ³>"
  destination_arn = <LAMBDAé–¢æ•°ã®ARN>
}
```

# ã‚¨ãƒ©ãƒ¼

## ä¸è¦ãªæŒ‡å®š

> Error: putting CloudWatch Logs Subscription Filter (***********): 
> InvalidParameterException: destinationArn for vendor lambda cannot be used with roleArn

Lambdaã‚’ä½¿ã†å ´åˆã¯ role_arn ã®æŒ‡å®šã¯ä¸è¦ã®ã‚ˆã†ã 

```
role_arn        = <ãƒ­ãƒ¼ãƒ«ã®ARN>
```

## æ¨©é™ä¸è¶³

ãƒ­ã‚°ãŒLambdaã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šãã†

>Error: putting CloudWatch Logs Subscription Filter (*****************): InvalidParameterException: Could not execute the lambda function. Make sure you have given CloudWatch Logs permission to execute your function.

```tf
resource "aws_lambda_permission" "yyy" {
  action        = "lambda:InvokeFunction"
  function_name = aws_lambda_function.some_lambda.function_name
  principal     = "logs.<REGION>.amazonaws.com"
}
```

# å…¬å¼

https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudwatch_log_subscription_filter#destination_arn


# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ


# Twitter

https://twitter.com/YumaInaura



# å…¬é–‹æ—¥æ™‚

2023-09-19
