---
title: "Rails â€“ APIãƒ¢ãƒ¼ãƒ‰ã§RailsAdminã‚’åˆ©ç”¨ã™ã‚‹"
emoji: "ğŸ–¥"
type: "tech"
topics: ["Rails", "RailsAdmin"]
published: true
published_at: 2023-09-15 14:58
---

# gem ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

Gemfileã«ä»¥ä¸‹ã‚’è¿½åŠ ã—ã¦ `bundle install`

```
gem 'rails_admin', '~> 3.1.2'
gem 'rails_admin-i18n'
```

# rails admin ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

`rails g rails_admin:install`

rails admin 3.1.2 ã§ã¯ Gemfile ã« `sassc-rails` ãŒè¿½åŠ ã•ã‚Œã‚‹ã®ã§ã‚‚ã†ä¸€åº¦ `bundle install`

# configã‚’è¿½åŠ ã™ã‚‹

`api/config/application.rb` 


```rb
config.middleware.use ActionDispatch::Cookies
config.middleware.use ActionDispatch::Flash
config.middleware.use Rack::MethodOverride
config.middleware.use ActionDispatch::Session::CookieStore, {:key=>"_backend_session"}
```

å‚è€ƒ: https://zenn.dev/atsushi101011/articles/5b76bf63cce9ac

# manifest.js ã®è¿½åŠ 

`rails server` ã§ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ä»¥ä¸‹ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã®ã§
```
Expected to find a manifest file in `app/assets/config/manifest.js` (Sprockets::Railtie::ManifestNeededError)
But did not, please create this file and use it to link any assets that need
to be rendered by your app:

Example:
  //= link_tree ../images
  //= link_directory ../javascripts .js
  //= link_directory ../stylesheets .css

and restart your server

```

ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã©ãŠã‚Šã«`app/assets/config/manifest.js` ã‚’è¿½åŠ ã™ã‚‹


```
  //= link_tree ../images
  //= link_directory ../javascripts .js
  //= link_directory ../stylesheets .css
```

# assets ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªè¿½åŠ 

![image](https://github.com/YumaInaura/YumaInaura/assets/13635059/618369cc-736c-4c5c-aff9-a36b78f8dcfe)


```
mkdir app/assets/images
mkdir app/assets/javascripts
mkdir app/assets/stylesheets
```

# ç”»é¢ã‚¢ã‚¯ã‚»ã‚¹

`api/config/routes.rb` ã«è¿½åŠ ã•ã‚ŒãŸãƒ‘ã‚¹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹

ä¾‹: `http://localhost:3000/admin/`

# READONLYã«ã™ã‚‹

è¨­å®šã§æ–°è¦ä½œæˆ/å‰Šé™¤/ç·¨é›†ã‚’ç„¡åŠ¹åŒ–ã™ã‚Œã°OK

`api/config/initializers/rails_admin.rb` 

```rb
RailsAdmin.config do |config|
  ...
  
  config.actions do
    dashboard                     # mandatory
    index                         # mandatory
    # new
    export
    # bulk_delete
    show
    # edit
    # delete
    show_in_app
  end
end
```

# è¡¨ç¤ºå¯¾è±¡ã®ãƒ†ãƒ¼ãƒ–ãƒ«(ãƒ¢ãƒ‡ãƒ«)ã‚’é™å®šã™ã‚‹

`api/config/initializers/rails_admin.rb` 

```rb
RailsAdmin.config do |config|
  ...
  config.included_models = %w[Book]
end
```


# èªè¨¼ã®è¿½åŠ  - Deviseã‚’åˆ©ç”¨ã™ã‚‹å ´åˆ

å¿…è¦ã«å¿œã˜ã¦Deviseç”¨ã®ãƒ¢ãƒ‡ãƒ«ãƒ»ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãƒ»ãƒ“ãƒ¥ãƒ¼ãªã©ã‚’ä½œæˆã™ã‚‹

```
rails g devise admin
rails g devise:views admins
rails g devise:controllers admins
```


## RailsAdminã®è¨­å®š

`api/config/initializers/rails_admin.rb`

```rb
RailsAdmin.config do |config|
  config.asset_source = :sprockets

  ### Popular gems integration

  ## == Devise ==
  config.authenticate_with do
    warden.authenticate! scope: :admin
  end
  config.current_user_method(&:current_admin)
...
```

https://blog.nightonly.com/2020/05/16/rails%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AB%E3%82%B5%E3%82%AF%E3%83%83%E3%81%A8railsadmin%E3%82%92%E5%B0%8E%E5%85%A5/


## ApplicationController ã®å•é¡Œ

Deviseã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§Railsã®ApplicacationControllerã‚’ç¶™æ‰¿ã™ã‚‹
ãªã®ã§ ApplicacationController ã§ `ActionController::API` ã‚’ç¶™æ‰¿ã—ã¦ã—ã¾ã£ã¦ã„ã‚‹ã¨ã¡ã‚‡ã£ã¨ã‚„ã‚„ã“ã—ã„

ã“ã®ç¶™æ‰¿å…ƒã‚’ ` ActionController::Base` ã«å¤‰ãˆã¦ã—ã¾ãˆã° Webç‰ˆã®Deviseã¯åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ãŒã€APIã®å‹•ä½œã«å½±éŸ¿ã—ãã†

ä¾‹:

```rb
class ApplicationController < ActionController::API
end
```

å¯¾å¿œã¨ã—ã¦ã¯deviseã®è¨­å®šã§è¦ªã¨ãªã‚‹ ApplicationController ã‚’å¤‰æ›´ã§ãã‚‹ã®ã§ãã†ã—ãŸ

```rb
Devise.setup do |config|
  config.parent_controller = 'DeviseApplicationController'
end
```

ã“ã†ã™ã‚‹ã¨Deviseå‘ã‘ã«ã¯ `ActionController::Base` ã‚’ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹ã‚’ä½¿ã†ã“ã¨ãŒå‡ºæ¥ã‚‹

ä¾‹:

```rb
class DeviseApplicationController < ActionController::Base
  protect_from_forgery
end
```

ãŸã å®Ÿè£…ã®APIã§ã‚‚Deviseã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯ã“ã® `DeviseApplicationController` ãŒä½¿ã‚ã‚Œã¦ã—ã¾ã†
Controllerã®å˜ä½ã§ç¶™æ‰¿å…ƒã¨ãªã‚‹ `ApplicationController` ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹è¨­å®šã¯ãªã•ãã†

APIå‘ã‘ã®å‡¦ç†ã§ã¯Deviseå‘ã‘ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã§ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã—ã¦åˆ©ç”¨ã™ã‚‹ã¨è‰¯ã„ã ã‚ã†
FLASHãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç„¡åŠ¹åŒ–ã™ã‚‹ã¨ã‹

```rb
class UserSessionsController < Devise::SessionsController
  # POST /resource/sign_in
  def create
    self.resource = warden.authenticate!(auth_options)
    # set_flash_message!(:notice, :signed_in)
    sign_in(resource_name, resource)
    yield resource if block_given?
    respond_with resource, location: after_sign_in_path_for(resource)
  end
end
```


# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ


# Twitter

https://twitter.com/YumaInaura




# å…¬é–‹æ—¥æ™‚

2023-09-12
