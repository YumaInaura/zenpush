---
title: "Rails - Rspec ã§ paralells spec ã‚’åˆ©ç”¨ã—ã¦ä¸¦åˆ—å‡¦ç†ã™ã‚‹ ( create / migrate / prepar"
emoji: "ğŸ–¥"
type: "tech"
topics: ["rails", "rspec"]
published: true
published_at: 2023-10-07 14:08
---

# å…¬å¼

https://github.com/grosser/parallel_tests

# Gemfile

gem ã‚’è¿½åŠ ã—ã¦ bundle install ã™ã‚‹

```
gem 'parallel_tests'
```

# database.yml

å…¬å¼READMEã®é€šã‚Š DBè¨­å®šã§ç’°å¢ƒå¤‰æ•°ã‚’åˆ©ç”¨ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹
ã“ã®ç’°å¢ƒå¤‰æ•°ã¯ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚ãªã©ã«è‡ªå‹•çš„ã« paralells spec ãŒä»˜ä¸ã—ã¦ãã‚Œã‚‹

```yml
test:
  database: yourproject_test<%= ENV['TEST_ENV_NUMBER'] %>
```

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```
rails parallel:setup
rails parallel:spec
```

ã†ã¾ãè¡Œã‹ãªã„å ´åˆã¯ä»¥ä¸‹ã§ã‚‚è‰¯ã„ã‹ã‚‚ã—ã‚Œãªã„
`parallel:setup` / `parallel:prepare` ã‚³ãƒãƒ³ãƒ‰ã¯ä½¿ã‚ãªãã¦ã‚‚ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã§ãã‚‹

```
rails parallel:create
rails parallel:migrate
rails parallel:spec
```

ä½•ã‹æ€ã‚ã¬ã‚¨ãƒ©ãƒ¼ãŒèµ·ããŸæ™‚ã¯ drop ã—ã¦ã‹ã‚‰ã‚„ã‚Šç›´ã™ã¨è‰¯ã„

```
rails parallel:drop
```

# ã‚³ãƒãƒ³ãƒ‰

## DBä½œæˆ

```
rake parallel:create
```

çµæœã®ä¾‹

ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆç”¨DBã‚’ä½œæˆã—ã¦ãã‚Œã‚‹

```
Created database 'example_test2'
Created database 'example_test4'
Created database 'example_test'
Created database 'example_test3'
```


## ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆç”¨DBã‚’ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹

```
rake parallel:migrate
```

## Prepare

developementã®ã‚¹ã‚­ãƒ¼ãƒã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã‚Œã‚‹ã‚‰ã—ã„ãŒè©³ç´°ã¯ä¸æ˜
ã‚ã¾ã‚Šæ€ã„ã¤ãç”¨é€”ãŒãªã„ã‹ã‚‚

ãƒ†ã‚¹ãƒˆç”¨DBãŒãªã„çŠ¶æ…‹ã§ã‚‚DBä½œæˆãƒ»ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆã¾ã§ã—ã¦ãã‚Œã‚‹æ¨¡æ§˜



>Copy development schema (repeat after migrations)

```
rake parallel:prepare
```

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

ã‚‚ã‚ã‚‚ã‚æº–å‚™ã—ã¦ãã‚Œã¦ create / migerate ãŒãŠã“ãªã‚ã‚ŒãŸçŠ¶æ…‹ã«ã—ã¦ãã‚Œã‚‹ã¿ãŸã„ã 
ãŸã ã— `seeds.rb` ã‚‚å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ãªã®ã§ãƒ†ã‚¹ãƒˆã«seeds.rbã®å€¤ã‚’å«ã‚ãŸããªã„å ´åˆã¯æ³¨æ„

>Setup environment from scratch (create db and loads schema, useful for CI

```
rake parallel:setup
```

## DBå‰Šé™¤

ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆç”¨DBã‚’å‰Šé™¤ã—ã¦ãã‚Œã‚‹

```
rake parallel:drop
```



# ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒ³ãƒãƒ¼å‹Ÿé›†


ä½•ã‹è³ªå•ã€æ‚©ã¿äº‹ã€ç›¸è«‡ãªã©ã‚ã‚Œã°LINEã‚ªãƒ¼ãƒ—ãƒ³ãƒãƒ£ãƒƒãƒˆã‚‚ã”åˆ©ç”¨ãã ã•ã„ã€‚

https://line.me/ti/g2/eEPltQ6Tzh3pYAZV8JXKZqc7PJ6L0rpm573dcQ


# Twitter

https://twitter.com/YumaInaura


# å…¬é–‹æ—¥æ™‚

2023-10-06
